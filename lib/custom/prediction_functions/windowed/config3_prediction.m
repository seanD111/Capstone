function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 21-Apr-2016 20:05:48.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 66xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 6xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-194.809818048627;-26.7331329931473;-38.4624542228069;-62.1181202841069;-33.3557803392397;-37.9132017832298;-46.3509916055386;-42.1836754160256;-37.295298847616;-36.6827143276185;-42.1420722203339;-43.4989471205404;-35.9094328098201;-610.228965320263;-564.794115960759;-588.707338688689;-325.827343157046;-329.700161266106;-475.943448772201;-386.729512174624;-367.661007684664;-519.097741931371;-475.628401896874;-433.696161568048;-397.707351154529;-608.04515600357;-1989.63839815725;-788.479709462832;-696.966234359947;-436.960175316527;-608.219719170257;-551.706533737909;-465.381803828066;-515.635906639629;-587.339685404384;-464.117350653849;-464.660277213478;-469.233493924714;-638.734714157982;-2.75628917388781;-1.54338420338527;-1.20687254975078;-0.949202599851014;-1.14471941656283;-0.792826641112649;-0.785729399342587;-0.682368521179;-0.563985794592814;-27.0818645522673;-12.2823357142191;-13.0168020708827;-9.22169030863946;-11.1205608798367;-8.17363468401284;-6.91548107856229;-7.5138831964702;-7.49074918269273;-36.5865907429763;-11.410504686759;-11.9114688497911;-10.2035555448804;-9.9853271711497;-10.4195450629781;-7.08468245351707;-7.78320616170947;-7.38595565521947];
x1_step1.gain = [0.00607538674703427;0.0235271753112198;0.0191297466032947;0.0209383396060104;0.0266789172917866;0.0245749366117307;0.0227444174790294;0.0243976523484374;0.0257528926759637;0.0254733879481049;0.0231371248219328;0.0244872768665979;0.0209857469245224;0.000635534281081666;0.00220824324798446;0.00218759002326137;0.00249452953941457;0.00281766225194279;0.00220065779935499;0.0025788219605096;0.00232304612078159;0.00211588836737191;0.00183242157031678;0.0023072514992385;0.0019970215397754;0.00185111685827001;0.000505522579647338;0.00152834691987226;0.0016612759472648;0.00199475518182476;0.00201868187885367;0.0021055462774131;0.00203821727075616;0.00207880523434537;0.00170255102738918;0.00184979628531586;0.00214579239020611;0.0021366613732587;0.00172375085802864;0.31807447050513;0.867267113440297;1.05690178391019;1.26908871753364;1.11682975303805;1.44102053764281;1.58165706225602;1.73198154780014;1.97718492769583;0.0307784049151371;0.0761124049997398;0.0829246742395222;0.103150636637586;0.0912988276147944;0.127539642336982;0.137497869661138;0.121261845377992;0.139931325209726;0.0299427512129768;0.0788750506608165;0.0877320879467329;0.106152733868256;0.102475953995283;0.109500088801036;0.138177769266804;0.116818690147992;0.134025225156786];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.51747163439511445;0.30099792578837997;0.16551695089719276;-0.16565030882148432;4.1228413942245048;-0.089716650192015024;2.5115830461002377;-5.3893414133256812;1.6180124974418948;1.6678037892965438];
IW1_1 = [6.7132050245814199 1.8957873033576875 -0.62776464442926438 -4.4343862065438628 1.8286809410530067 1.1658640985017863 0.076200082397513164 -0.55559678049738093 0.83057385922487137 0.99849563615136838 1.0055687937586599 -0.44374040994104808 0.93587261172772684 2.6159382946079641 0.079698586978903002 -0.86764857139296869 0.035919495905658134 0.86154727574521917 -0.34252470598049867 -0.03677808908873105 0.01242196559467441 0.060366196330982086 -0.07416440435250074 0.066200901341954194 0.035873388814961805 -0.087783865756159998 3.7885036548218411 1.06881399317586 -0.42428702217916325 -2.0874300267841646 0.95869595582266787 0.69284790271379737 0.069162867345742521 -0.28551910152562204 0.53736085950775803 0.67065730340285734 0.53843318148743213 -0.36441818673905663 0.66205792590198365 -2.4804197421256662 0.77828794826234438 -0.90640500427151627 1.0043274770085819 0.13274464577223657 1.6233994589425849 -1.2435831792308509 -1.1214188659424054 0.082089173385953215 -0.24227084622012385 -0.52866382881102669 0.58515050003086633 0.051694210008870929 0.31718565156268669 -0.47051630363315644 -0.10810951449444638 -0.03848582832933771 0.55122378868710409 -1.0363551448076813 0.46276576262845637 -0.40576264671328799 0.81375823636913991 0.06605596319210541 0.94856460212858196 -0.68175941825393405 -0.76460050082844533 0.28847562011497369;1.9424375396537814 -0.52921523044184515 -0.35023674307359542 0.74746114819500764 0.095535412084657614 0.26619697127963315 -0.40333004256186383 0.23393672575077301 -0.30479067070009436 -0.015616975005794641 0.25052429911152879 0.37551672185622348 -0.067683972385323782 -2.5254698766472674 3.342668026996745 -6.1974069047129268 0.11170463528435032 4.7574495019614433 -0.42965776232700531 -0.037399445241945009 0.11424445401954011 -0.40610085148729957 -0.52948827016697975 -0.41879618396082785 -0.040563419091168798 -0.19196856638543844 1.780881383224532 -1.1546752596741121 0.83436900727482033 0.054556251928545789 -0.97304798933530556 0.29719768551633835 -0.17268463129035061 0.30411366360912961 0.050956363468598678 0.09634496419895372 0.19194218480690942 0.23922482244910126 -0.095807718931809061 -0.20275872167674816 0.23989595346289588 1.2024637725339931 0.2003859013272784 -1.1386181260169086 -0.12854684002301045 0.80581605933988065 0.72442268826899625 0.10461604412453841 0.65200222350986736 -2.2838373920908754 1.8000055122694361 1.8203149081765408 -4.0667847857545594 -1.7123952448490043 2.7478784716291673 2.3265742812510939 -0.091950326967979959 0.31747259513087672 -0.49173817361571243 1.300618149241423 0.92551007671736896 -1.8632874222613767 -0.96326111241214529 0.9513648651799298 1.3090344084655263 0.082177524522729306;1.8859476897429683 0.15256677171792915 -0.96477440638282963 0.33438774951736072 1.6221762003478204 -0.56428189617045821 0.17807061972553645 -0.36028736070722606 -0.52788689692216295 -0.40480548750298301 -0.42871277713196443 -0.25731552235791322 0.22851535531961958 1.2172514312645109 0.5565032547892873 -2.229773220886325 -0.17390244821126247 0.47535316320368298 -0.93642341209757729 0.034808202088558976 -0.14691058501880105 0.028064819051042331 0.13339884007631525 0.036499534477563086 0.091153931638248892 0.00044145114089501184 1.5047112116693067 -0.28642505550959441 -0.011086154153666801 0.068473812643472146 0.92432249786390741 -0.22744675727443359 0.071253096914062772 -0.1185297366170768 -0.41804878864194828 -0.3209954825047367 -0.21908005763150992 -0.1717312116449331 0.11648738780598679 -0.21197827344633235 -0.32105692211326942 0.087604733477851263 0.13560577470647733 0.43084702785514573 -0.31164974674904994 -0.43456350776171793 -0.18855062324346669 0.888744043325841 0.46804197282686077 -0.90219778334316436 0.76432077004771892 0.61236859897003293 1.2769782716178399 -0.36524809752728526 -0.19323525430792293 0.081697873560871923 0.73863941486330609 0.67945885396989303 -0.76709755680756653 0.44367386066816927 0.23430361583538015 0.69970172208694592 -0.30446635530347199 -0.1640640210641664 -0.17310146667851523 1.0279312798927422;3.9670337914047042 -5.1755730902700616 0.92008962007043138 -0.73792039986664015 0.37632513004778917 -0.8978573216414244 0.1217535253391283 0.27513846086086002 0.560183384417828 -0.0084760187623988802 -0.14277455999946664 -0.077919374760333587 -0.089631398173948371 1.76004413205504 1.4908584744064721 -1.6908948790368239 -1.1676557766994953 0.0024666641791834358 -0.22621711654915902 -0.016170039757334789 -0.15243642564427914 0.43882517713070163 0.27274104248251341 -0.28852759899286368 0.35211573025478454 -0.25994517650307125 0.27731843071021173 -1.6704230812273111 -0.42281402046117 0.35617584893558007 -0.032781452324736324 -0.1713030283113065 0.14101248077290024 0.22713027371988004 0.34248314922547107 0.063311680298137052 -0.1538089344473004 0.021223930883272887 -0.13420965264517909 1.4947693365957846 -2.4281874602296014 3.2694411392336624 -0.76499817833996575 0.16847104335775162 -0.091986536798963445 -0.37098361740645169 0.38169343710989762 -0.045292732572501784 2.7636273151607917 -0.42546774324626918 -0.59847013704707708 1.1857317996999526 0.64023169771790378 0.65315736005830016 0.37731803550136583 -0.12247489977534641 0.45984418272250582 -0.38190690628148588 2.1973126587638387 0.11016977705639536 0.76102129080662462 -0.13977111497030312 0.22801039930271974 -0.33132093634810966 0.74323308026123469 -0.37805688874116861;-15.564495472515732 -4.5724861291300698 -1.8655017671777592 -4.2339898026654579 -1.4828604492081729 0.025147523256006034 -0.97663984004013593 -0.68279850435707812 1.0090759857704339 -0.60429062791778154 -0.84921414645064197 0.98383346498608382 -1.4730386612239819 -0.15105196338849375 -0.68053164262284516 0.39560652304869903 1.3476463561306644 -0.46554209827550114 0.73752209505798061 0.80893132516564092 0.078920066718041637 -0.071484061403479779 -0.2221661932007063 -0.035030369629742028 0.063250923360599592 -0.049629431788820309 -5.0405239697182642 -2.4755860740757818 0.097425428426367686 -2.5088547197482729 0.20459063337586569 0.088315110862540736 0.087669948357664382 0.019155150312518632 1.2352729710261474 -0.15122830485696884 -0.82777823115370297 0.5898731633757569 -0.25008685304412914 2.7349052256403352 7.4344613107396871 -0.67796185476075022 1.3387500145474935 0.74509051717772701 2.7108803339643437 -0.48381803925519801 -0.36143211328631553 0.14527804340028788 0.24650559589562099 2.1370294106946446 -0.27705266291571856 0.27303283627630925 -0.16267966059559802 1.2046568161671916 0.16941074822341709 -0.0006990584835032173 0.80932414757883953 1.237019854073365 3.708428790194974 -1.5046431246613847 0.6711262359346335 0.50813051363305195 0.83749156613628351 -0.66173260458753136 -0.19327459835104929 -1.2124728386108539;1.2259543573058425 -0.74470545239577379 0.27031946212677976 1.2532333166630498 1.4937104175215867 0.8687347802621499 -0.015432889242133018 -0.16172672198454258 -0.029601411112835357 0.2776889597611345 -0.67775390173835881 -0.58842016982728451 -0.0066737917764016991 2.9035432638443806 -0.25569033820754811 1.8254198878798591 0.31989514032169969 -0.73496680926558511 0.14350783439934051 -0.014654512246665948 -0.074053781082128026 0.040241334041554229 0.068970842674888636 0.080409463531630726 -0.060212957207891854 -0.0060180935657555869 -0.018866103690753505 -0.67484054804837623 -0.36741620042585954 0.81244571005775268 1.0384687674712183 0.38754876871071564 -0.019667381008095904 -0.12196221016426802 -0.13665044760265085 0.23128264456129607 -0.39429596486662766 -0.36649954929459305 0.047063024717436494 -1.7895165375654913 0.42196349813190465 -1.0460618516753888 -0.59054518533313305 -1.5077363493759441 0.37154470960899222 -0.78132382777304721 -0.65907174939397162 0.046849224904855227 -1.053600224079138 0.15661900611919624 -0.53909859639733559 -0.47857832541300049 0.76872779180956097 0.27688181364654929 -0.55426108005400099 -0.45947991461335908 0.087910479679795581 -1.4609567214009511 0.33144217300238693 -0.68988789113445936 -0.46608995825838984 -0.56381172428459536 0.38783956668793068 -0.57493769600502487 -0.55997414066377182 0.051558953567738916;-5.0484237843476754 -1.7686517960600467 -3.1391690897317135 -1.7269628341254111 -1.3146149835925094 -1.3377463523212663 -1.357749622766939 -1.6745207266671447 -1.0512442754559836 -0.41168062376591674 -0.60490394046048168 0.7071527526502045 -1.4367687206592676 -0.040099298042236366 -1.1861502159820159 0.36907518727000416 -0.20120080176328717 0.030474686645772325 -0.071565628779462181 -0.039153222074291151 0.18324431334337701 0.0083143477486866714 0.0053819345602855242 0.11797440677230614 0.0063599580036467519 0.1230653166615943 -3.2537761143351052 -1.0339239745037458 -1.5781202173959974 -1.0965058686561251 -0.67413502669641112 -0.85595680077497827 -0.77079852996376907 -1.013140224892447 -0.7341274365867273 -0.35357551078075306 -0.30700309075439464 0.41513419791243938 -0.96078771150005038 0.57123440926958158 1.5444470664615726 0.94351241856178869 0.72389868166597127 1.201569772611621 0.28632397800818044 0.93310422376797109 -0.053613636054389686 0.23800185895095424 -0.60135831465803757 -0.084435058872514582 0.84500462685185085 -0.47753471990484148 0.066646324997011175 -0.10611513776285569 -0.10085658119507113 -0.12742861434993394 -0.14769489648605999 0.69555341110350744 0.18739833541015352 0.79576635429070297 0.12594099584277191 0.77699504388650331 0.21943200358758591 0.49248424300913146 -0.22603803930039837 0.30205662602313871;3.6926695225426363 -0.29620841051735747 0.25853105708142277 0.5848688961973304 -0.59689113527259996 0.30697320157166691 0.069073884659812679 0.12743033957305711 -0.015008672288656096 0.020683132618032261 -0.73459402092559478 -0.1226190693493516 0.3716954933064251 -5.9097493840572666 4.4700974187257527 2.4762883105516171 2.2656142412409692 -0.55657691060456316 1.3476903467176349 -0.11722547457960167 0.083455358584406142 -0.49329413312427317 -0.39773043448290718 -0.1580181828117567 -0.27038710388860787 -0.012915323714706554 3.5921880175769698 -1.4058219482668888 0.4781740526640525 -0.25837581989906511 -0.27613418927219929 0.18828019859917816 -0.073821325993657691 0.11108375416036936 0.021543339649643199 0.31033173369040701 -0.43963291146116695 0.042384995739133492 0.30814843560348887 2.5661501986307185 -1.2167670069393577 -0.5514515853370564 -0.64916779114318846 0.35615498593632561 -0.33329738088226396 0.90733305776620321 0.21179755013190554 0.14942173385822488 -0.31108564182514586 1.0648730433850764 -3.7731664630822395 -0.076252924189787213 -2.4762078662266398 0.24656357107464708 -0.12559875874399853 0.9627922245844488 -1.0248628608915851 -0.056824612504734973 -1.2740448586360749 -0.82353744991151334 -0.71600777159102158 -0.37821541299371825 -0.032691321185184585 0.15763932849221315 0.33975091596575685 -0.58282314989587614;-0.61637889329451701 -0.087310756060432565 0.66851012301551593 -3.6806582547584297 1.2894242517557877 1.7374835770622425 -0.46332478869214405 -0.37203393946468483 0.1314120299150762 0.31099848895070725 0.37113722422823703 -0.25512633062531453 -0.40346506843249191 -1.02269494906412 -1.6217185008221426 2.2407418646567465 -0.29015885075133302 0.77070585552418125 0.8449623977126699 -0.07731164676656184 0.32474540101689248 0.030325284357938791 -0.28553032583508953 0.027884269088309342 -0.087484148954970031 -0.054803021019207046 -1.840609108248251 0.4413385252581854 -0.67777952646399209 -1.4280927060242661 0.71939237830431557 0.66823624267094106 -0.22657959822358179 -0.25315206050194511 -0.028505535191209418 0.23803372400066697 0.19558388422929421 -0.28207891967135829 -0.10378505134551301 -2.975839134933322 2.5620644721752526 -1.7167112937846383 0.17071019637894089 -2.0044508243028059 1.5046768606977912 -1.0079944071063522 -1.3844340010841576 -1.2213461053748607 -0.19801085282457159 0.91540976277633701 0.14131564106798419 -1.0927892226995244 -1.3924193062430208 0.052882830110791826 0.20122537891170003 -0.27155656277726675 -0.53239255628731974 -1.3153315051054124 2.2562053253049057 -1.1865696493932165 0.067739078125027025 -1.5140214759802215 0.96617479091882652 -0.57655703341857012 -0.97861718808063025 -1.0078042110370908;-3.2677663790512903 2.2685327139890505 -0.34209038191244706 -2.025927788740177 1.2127277737391331 -1.5547783516136684 -0.4119671187134647 -0.35423040579471043 -0.050414053541217502 -0.26435718332324026 -0.045714542367303448 -0.21396568548742123 0.32315404254781827 0.33231053257076665 4.5489445375803381 -0.26817529723586492 0.67714876060313289 0.26953719980929763 -0.036825412711032242 0.092066379603002249 -0.19168637850425646 0.0062160828241070529 -0.032952134221295337 -0.070036607773137638 0.042066693561825526 -0.071719634970692253 -2.1994833162450944 1.0134684548722368 -0.030105745719448417 -1.0053148852055795 0.61711709727068231 -0.65296971735970166 -0.24029824746971168 -0.091921945844819691 -0.068343543858973635 -0.012671135793361816 -0.075512071947799977 -0.13078264703388187 0.3316641552477726 1.1510644614098184 -0.47387401677595908 -2.1069753062427643 -0.10554219831947552 1.1689103917999673 1.5905535173532457 -0.84097602436881169 -0.29831970940664515 1.1568040119245144 0.43071803803373709 -0.59420447300085244 -2.2241348021422236 0.62065920628852045 0.34629901032072236 0.2342495575135452 -0.5902361424030963 0.28210168265760749 0.4849071960518973 -0.05594431646302675 -0.015679185964538277 -2.0147854184584149 0.18985267848068166 0.65392425920466413 1.083683560189457 -0.7756760681121817 -0.058481830080071642 0.63794787887456661];

% Layer 2
b2 = [2.1677057492747509;-0.20263426968483425;-3.7685787418196468;8.4222802521689442;-3.4127110472872886;-4.709473445778082];
LW2_1 = [-2.6976477269535226 8.052715500926924 -9.9142691936180789 -4.5216517441535213 -17.956008336707455 7.2697712945797655 1.6624732222013185 -7.3145389532831864 -7.0844809023065727 8.9265924880948653;0.9838006033790605 -1.3321534268818491 3.7400958283671786 0.43632845483254856 3.3389047403700656 -1.4338707743099213 1.5679551510145031 2.7111390028770423 0.87500229492448289 0.29001871257630929;1.7509716147108088 -0.9854762844843169 4.868340934119904 1.6706391399389859 13.059190354514726 0.57742074021643297 -0.35562292677026769 4.7857853218938029 2.2395395316300486 -8.9010009401060763;-1.5164209817220413 -2.1025554900341228 -2.4586220511841104 -3.2950556274673977 -3.2571291762151833 -3.3808145715485161 -2.465393415017139 -3.3128768771919463 1.6224498100368614 4.0282913753466003;4.7409277557430523 -0.678645755882051 -2.001775319274218 4.0247508780681587 5.3203060719059625 0.47473823617927574 4.0414820634394042 2.6972298264734307 -0.84237417650444846 -3.1530336873408644;-3.1816188203562086 -1.447909198752517 4.8560998114789049 0.080193268815857047 -2.0396263693778436 -0.67960131358776543 -0.0041715518113673647 0.86637685838870293 4.7519833000343299 0.039877510825450303];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
else
    a = iSoftmaxApplyCPU(n);
end
end
function a = iSoftmaxApplyCPU(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numerator = exp(n);
denominator = sum(numerator,1);
denominator(denominator == 0) = 1;
a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
nmax = max(n,[],1);
numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
denominator = sum(numerator,1);
a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
if (denominator == 0)
    a = numerator;
else
    a = numerator ./ denominator;
end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
